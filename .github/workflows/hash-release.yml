name: Generate SHA256 Hashes for Release Assets

on:
  release:
    types: [published]

jobs:
  generate-checksums:
    runs-on: ubuntu-latest
    
    steps:
    - name: Download release assets
      uses: actions/download-release-asset@v1
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        tag: ${{ github.event.release.tag_name }}
        file_pattern: "*"

    - name: Generate SHA256 checksums
      run: |
        mkdir checksum-output
        for f in *; do
          if [ -f "$f" ]; then
            sha256sum "$f" >> checksum-output/checksums.txt
          fi
        done
        echo "Generated checksums:"
        cat checksum-output/checksums.txt

    - name: Upload checksum file to release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.event.release.tag_name }}
        files: checksum-output/checksums.txt
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
